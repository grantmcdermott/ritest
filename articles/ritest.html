<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to ritest • ritest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ritest">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ritest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ritest.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/grantmcdermott/ritest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to ritest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/ritest/blob/main/vignettes/ritest.Rmd" class="external-link"><code>vignettes/ritest.Rmd</code></a></small>
      <div class="d-none name"><code>ritest.Rmd</code></div>
    </div>

    
    
<p>Let’s start by loading the <strong>ritest</strong> package. I’ll also
be using one or two outside packages in the examples that follow to
demonstrate some additional functionality, but will hold off loading
those for now.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grantmcdermott/ritest" class="external-link">ritest</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/ritest.html">ritest()</a></code> function supports a variety of arguments,
but the basic syntax is</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">resampvar</span>, reps<span class="op">=</span><span class="fl">100</span>, strata<span class="op">=</span><span class="cn">NULL</span>, cluster<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>where:</p>
<ul>
<li>
<code>object</code> is a model object (e.g. a linear
regression).</li>
<li>
<code>resampvar</code> is the variable that you want to resample
(i.e. permute). You can also specify the sharp null hypothesis that you
want to test as part of a character string.</li>
<li>
<code>reps</code> is the number of simulations
(i.e. permutations).</li>
<li>
<code>strata</code> is a variable defining the stratification (aka
“blocking”) of the experimental design, if any.</li>
<li>
<code>cluster</code> is a variable defining the clustering of
treatment in the experimental design, if any.</li>
<li>
<code>...</code> are other arguments. This includes the ability to
set a random seed for reproducibility, controlling the parallelism
behaviour, adding a progress bar, etc. See <code><a href="../reference/ritest.html">?ritest</a></code> for more
information.</li>
</ul>
<p>Let’s see this functionality in action with the help of some
examples.</p>
<div class="section level2">
<h2 id="example-i-toy-data">Example I: Toy data<a class="anchor" aria-label="anchor" href="#example-i-toy-data"></a>
</h2>
<p>Our first example will be a rather naive implementation using the
base <a href="https://vincentarelbundock.github.io/Rdatasets/doc/MASS/npk.html" class="external-link"><code>nkp</code></a>
dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">K</span>, data <span class="op">=</span> <span class="va">npk</span><span class="op">)</span></span></code></pre></div>
<p>Let’s say we’re interested in the yield effect of ‘N’
(i.e. nitrogen). We want to know whether our inferential reasoning about
this parameter is robust to using RI, as opposed to just relying on the
parametric t-test and p-value produced by our linear regression model.
We’ll do 1,000 simulations and, just for illustration, limit the number
of parallel cores to 2. (The default parallel behaviour will use half of
the available cores on a user’s machine.) The ‘verbose = TRUE’ argument
simply prints the results upon completion, including the original
regression model summary.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_ri</span> <span class="op">=</span> <span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">'N'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running 1000 parallel RI simulations as forked processes across 2 CPU cores.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ******************</span></span>
<span><span class="co">#&gt; * ORIGINAL MODEL *</span></span>
<span><span class="co">#&gt; ******************</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = yield ~ N + P + K, data = npk)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -9.2667 -3.6542  0.7083  3.4792  9.3333 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   54.650      2.205  24.784   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; N1             5.617      2.205   2.547   0.0192 *  </span></span>
<span><span class="co">#&gt; P1            -1.183      2.205  -0.537   0.5974    </span></span>
<span><span class="co">#&gt; K1            -3.983      2.205  -1.806   0.0859 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 5.401 on 20 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.3342, Adjusted R-squared:  0.2343 </span></span>
<span><span class="co">#&gt; F-statistic: 3.346 on 3 and 20 DF,  p-value: 0.0397</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ******************</span></span>
<span><span class="co">#&gt; * RITEST RESULTS *</span></span>
<span><span class="co">#&gt; ******************</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt;           Call: </span>lm(formula = yield ~ N + P + K, data = npk)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">   Res. var(s): </span>N1</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">            H0: </span>N1=0</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">     Num. reps: </span>1000</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span></span>
<span><span class="co">#&gt;    5.617        21      1000     0.021  0.007462  0.008726   0.03327  </span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span></span>
<span><span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></span></code></pre></div>
<p>In this simple case, our parametric results appear to hold up very
well. The original p-value of 0.019 is very close to the equivalent
rejection rate of 0.021 that we get with our RI procedure.</p>
<p>We can also visualize this result using the dedicated
<code>plot</code> method. The function takes several arguments for added
customization. But here I’ll just show the default plot, which includes
vertical lines that denote the simulated (in this case: 95 percent)
rejection regions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est_ri</span><span class="op">)</span></span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_est_ri-1.png" class="r-plt" alt="" width="700"></p>
<p>As an aside, note that the RI procedure tests against a standard
two-sided null hypothesis of zero. (In the above case:
<code>H0: N1=0</code>.) We can specify a different null hypothesis as
part of the <code>resampvar</code> string. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">'N&lt;=2'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_est_ri_alt_ho-1.png" class="r-plt" alt="" width="700"></p>
<p>Note that we could (and probably should) have estimated a more
realistic model that controls for the stratified (aka “blocked”) design
of the original <code>npk</code> experiment. This is easily done, but
we’ll hold off doing so for now since the the discussion of strata
provides a nice segue to our next example.</p>
</div>
<div class="section level2">
<h2 id="example-ii-real-life-data">Example II: Real-life data<a class="anchor" aria-label="anchor" href="#example-ii-real-life-data"></a>
</h2>
<p>Our second example will provide a more realistic use-case, where we
need to account for a <em>stratified</em> and <em>clustered</em>
research design. In particular, we’ll replicate a real-life experiment
that David McKenzie describes in a very helpful <a href="https://blogs.worldbank.org/impactevaluations/finally-way-do-easy-randomization-inference-stata" class="external-link">blog
post</a> on the original Stata <code>-ritest-</code> routine.</p>
<p>The dataset in question derives from a randomized control trial about
supply chains in Colombia, which David has kindly provided for re-use in
this package (see: <code><a href="../reference/colombia.html">?colombia</a></code>). The key research question
that we’re trying to answer below is whether a treatment intervention
(<code>b_treat</code>) led to a drop in the number of days requiring
visits to the <em>Corabastos</em> central market.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Repeated visits to the market are an expensive and
time-consuming exercise for the fresh produce vendors that formed the
study population.&lt;/p&gt;"><sup>1</sup></a> Moreover, we want to
know if our inference about this treatment effect is robust to RI.</p>
<div class="section level3">
<h3 id="stata-implementation">Stata implementation<a class="anchor" aria-label="anchor" href="#stata-implementation"></a>
</h3>
<p>As a benchmark, first we recapitulate David’s Stata code and output.
I won’t go into details — the essential thing to know is that I’m going
to run 5,000 RI permutations on a pretty standard fixed-effect model,
whilst accounting for the stratified and clustered design of the
experiment.</p>
<p>(Aside: I’m also snipping most of the Stata output, so as to only
highlight the main command and result.)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>. <span class="co">// This next line assumes you have exported the `colombia` dataset from R as a</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>. <span class="co">// CSV for Stata to read, e.g. `write.csv(colombia, '~/colombia.csv', row.names = FALSE)`</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>. <span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"~/colombia.csv"</span>, <span class="kw">comma</span> <span class="kw">clear</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>. </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>. <span class="kw">timer</span> <span class="kw">on</span> 1</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>. </span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>. ritest b_treat _b[b_treat], <span class="kw">cluster</span>(b_block) <span class="kw">strata</span>(b_pair) reps(5e3) <span class="dv">seed</span>(546): <span class="co">///</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>&gt; <span class="kw">areg</span> dayscorab b_treat b_dayscorab miss_b_dayscorab round2 round3, <span class="kw">cluster</span>(b_block) a(b_pair)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>[snipped]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>      command:  <span class="kw">areg</span> dayscorab b_treat b_dayscorab miss_b_dayscorab round2 round3, <span class="kw">cluster</span>(b_block)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>                    a(b_pair)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>        _pm_1:  _b[b_treat]</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  res. <span class="kw">var</span>(<span class="fu">s</span>):  b_treat</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>   Resampling:  Permuting b_treat</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>Clust. <span class="kw">var</span>(<span class="fu">s</span>):  b_block</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>     Clusters:  63</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>Strata <span class="kw">var</span>(<span class="fu">s</span>):  b_pair</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>       Strata:  31</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>T            |     T(<span class="kw">obs</span>)       c       n   <span class="kw">p</span>=c/n   <span class="kw">SE</span>(<span class="kw">p</span>) [95% Conf. Interval]</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>       _pm_1 |   -.180738     529    5000  0.1058  0.0043  .0974064   .1146569</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>Note: Confidence interval is with respect to <span class="kw">p</span>=c/n.</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>Note: c = #{|T| &gt;= |T(<span class="kw">obs</span>)|}</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>. </span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>. <span class="kw">timer</span> <span class="kw">off</span> 1</span></code></pre></div>
<p>Like David, this takes around <strong>3 minutes</strong> to run on my
laptop.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>. <span class="kw">timer</span> <span class="ot">list</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>   1:    183.01 /        1 =     183.0150</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="r-implementation">R implementation<a class="anchor" aria-label="anchor" href="#r-implementation"></a>
</h3>
<p>Let’s replicate the above in R using this package. First, we’ll
estimate and save the parametric model using
<code><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">fixest::feols()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"colombia"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span> <span class="co">## For fast (high-dimensional) fixed-effects models</span></span>
<span></span>
<span><span class="va">co_est</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span></span>
<span>    <span class="va">dayscorab</span> <span class="op">~</span> <span class="va">b_treat</span> <span class="op">+</span> <span class="va">b_dayscorab</span> <span class="op">+</span> <span class="va">miss_b_dayscorab</span> <span class="op">|</span> <span class="va">b_pair</span> <span class="op">+</span> <span class="va">round2</span> <span class="op">+</span> <span class="va">round3</span>, </span>
<span>    vcov <span class="op">=</span> <span class="op">~</span><span class="va">b_block</span>, data <span class="op">=</span> <span class="va">colombia</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 1,020 observations removed because of NA values (LHS: 1,020).</span></span>
<span><span class="va">co_est</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: dayscorab</span></span>
<span><span class="co">#&gt; Observations: 2,346</span></span>
<span><span class="co">#&gt; Fixed-effects: b_pair: 31,  round2: 2,  round3: 2</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (b_block) </span></span>
<span><span class="co">#&gt;                   Estimate Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; b_treat          -0.180738   0.078174 -2.31201  0.024113 *  </span></span>
<span><span class="co">#&gt; b_dayscorab       0.524761   0.029423 17.83478 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; miss_b_dayscorab  0.603928   0.264174  2.28610  0.025678 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 1.91167     Adj. R2: 0.282038</span></span>
<span><span class="co">#&gt;                 Within R2: 0.266002</span></span></code></pre></div>
<p>Now, we conduct RI on our model to see whether our key treatment
variable (<code>b_treat</code>) is sensitive to the imposed parametric
constraints. Note that we can specify the strata and clusters as
additional arguments to <code><a href="../reference/ritest.html">ritest()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tic</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="co">## timer on</span></span>
<span></span>
<span><span class="va">co_ri</span> <span class="op">=</span> <span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">co_est</span>, <span class="st">'b_treat'</span>, cluster<span class="op">=</span><span class="st">'b_block'</span>, strata<span class="op">=</span><span class="st">'b_pair'</span>, reps<span class="op">=</span><span class="fl">5e3</span>, seed<span class="op">=</span><span class="fl">546L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">toc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">tic</span> <span class="co">## timer off</span></span>
<span></span>
<span><span class="co">## Print the results</span></span>
<span><span class="va">co_ri</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt;           Call: </span>feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">   Res. var(s): </span>b_treat</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">            H0: </span>b_treat=0</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;"> Strata var(s): </span>b_pair</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">        Strata: </span>31</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Cluster var(s): </span>b_block</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">      Clusters: </span>63</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">     Num. reps: </span>5000</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span></span>
<span><span class="co">#&gt;  -0.1807       520      5000     0.104  0.007102   0.09232    0.1157  </span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span></span>
<span><span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></span></code></pre></div>
<p>Using the same random seed in R and Stata is a bit of performance
art. We won’t get exactly the same results across two different
languages. But the important thing to note is that they are functionally
equivalent (rejection probability of 0.106 vs 0.104). More importantly,
we can see that our inference about the effectiveness of treatment in
this study is indeed sensitive to RI. Our parametric p-value (0.024) is
much lower than the permuted rejection rate (0.104).</p>
<p>Again, we can plot the results. Here’s a slight variation, where we
plot in histogram form and use a fill to highlight the 95% rejection
region(s) instead of vertical lines.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">co_ri</span>, type <span class="op">=</span> <span class="st">'hist'</span>, highlight <span class="op">=</span> <span class="st">'fill'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_co_ri-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h3>
<p>One nice feature of the R implementation is that it should complete
very quickly. Instead of taking 3 minutes, this time the 5,000
simulations only take around <strong>6 seconds</strong>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">toc</span></span>
<span><span class="co">#&gt; Time difference of 6.581697 secs</span></span></code></pre></div>
<p>As a general observation, the R implementation of
<code><a href="../reference/ritest.html">ritest()</a></code> doesn’t yet offer all of the functionality of the
Stata version. For example, it doesn’t support an external file of
resampling weights. However, it does appear to be a lot (25x – 50x)
faster and this might make it more suitable for certain types of
problems.</p>
</div>
</div>
<div class="section level2">
<h2 id="extras-and-asides">Extras and asides<a class="anchor" aria-label="anchor" href="#extras-and-asides"></a>
</h2>
<div class="section level3">
<h3 id="regression-tables">Regression tables<a class="anchor" aria-label="anchor" href="#regression-tables"></a>
</h3>
<p>Support for regression tables is enabled via
<strong>ritest’s</strong> compatability with the
<strong>modelsummary</strong> package. I recommend displaying p-values
instead of the default standard errors. This is particularly important
when comparing against a parametric model, as I do below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com" class="external-link">modelsummary</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://modelsummary.com/man/msummary.html" class="external-link">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="va">co_est</span>, ritest <span class="op">=</span> <span class="va">co_ri</span><span class="op">)</span>, </span>
<span>         statistic <span class="op">=</span> <span class="st">'p.value'</span>, </span>
<span>         <span class="co">## These next arguments just make our comparison table look a bit nicer</span></span>
<span>         coef_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'b_treat'</span> <span class="op">=</span> <span class="st">'Treatment'</span><span class="op">)</span>, </span>
<span>         gof_omit <span class="op">=</span> <span class="st">'Obs|R2|IC|Log|F'</span>,</span>
<span>         notes <span class="op">=</span> <span class="st">'p-values shown in parentheses.'</span><span class="op">)</span></span></code></pre></div>
<!-- preamble start -->

    <script src="https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js"></script><script>
      // Create table-specific functions using external factory
      const tableFns_e2c9sfxjffny1wmbg6ou = TinyTable.createTableFunctions("tinytable_e2c9sfxjffny1wmbg6ou");
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '8', j: 2 }, { i: '8', j: 3 } ], css_id: 'tinytable_css_n04scpveqzjrw1qzn0c5',}, 
          { positions: [ { i: '2', j: 2 }, { i: '2', j: 3 } ], css_id: 'tinytable_css_8e7qjktvkfahxkgxib56',}, 
          { positions: [ { i: '1', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '1', j: 3 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '6', j: 3 }, { i: '7', j: 3 } ], css_id: 'tinytable_css_w6e5x9n8a0rj2nb36ijc',}, 
          { positions: [ { i: '0', j: 2 }, { i: '0', j: 3 } ], css_id: 'tinytable_css_nkgzix9zvl6dff2v4m1a',}, 
          { positions: [ { i: '8', j: 1 } ], css_id: 'tinytable_css_t3pcw92ixvcn0und20z0',}, 
          { positions: [ { i: '2', j: 1 } ], css_id: 'tinytable_css_obh2bbqo0i2j6zstrqif',}, 
          { positions: [ { i: '1', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 } ], css_id: 'tinytable_css_pnzchepudt2lk1e0cj78',}, 
          { positions: [ { i: '0', j: 1 } ], css_id: 'tinytable_css_wjs11y55ga2gtj2jw2nh',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  tableFns_e2c9sfxjffny1wmbg6ou.styleCell(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css">
<style>
    /* tinytable css entries after */
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_n04scpveqzjrw1qzn0c5, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_n04scpveqzjrw1qzn0c5 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.08em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_8e7qjktvkfahxkgxib56, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_8e7qjktvkfahxkgxib56 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_w6e5x9n8a0rj2nb36ijc, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_w6e5x9n8a0rj2nb36ijc { text-align: center }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_nkgzix9zvl6dff2v4m1a, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_nkgzix9zvl6dff2v4m1a {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.08em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_t3pcw92ixvcn0und20z0, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_t3pcw92ixvcn0und20z0 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.08em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_obh2bbqo0i2j6zstrqif, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_obh2bbqo0i2j6zstrqif {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_pnzchepudt2lk1e0cj78, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_pnzchepudt2lk1e0cj78 { text-align: left }
    #tinytable_e2c9sfxjffny1wmbg6ou td.tinytable_css_wjs11y55ga2gtj2jw2nh, #tinytable_e2c9sfxjffny1wmbg6ou th.tinytable_css_wjs11y55ga2gtj2jw2nh {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.08em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    </style>
<div class="container">
      <table class="table tinytable" id="tinytable_e2c9sfxjffny1wmbg6ou" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col" data-row="0" data-col="1"> </th>
                <th scope="col" data-row="0" data-col="2">lm</th>
                <th scope="col" data-row="0" data-col="3">ritest</th>
              </tr></thead>
<tfoot><tr><td colspan="3">p-values shown in parentheses.</td></tr></tfoot>
<tbody>
<tr>
<td data-row="1" data-col="1">Treatment</td>
                  <td data-row="1" data-col="2">-0.181</td>
                  <td data-row="1" data-col="3">-0.181</td>
                </tr>
<tr>
<td data-row="2" data-col="1"></td>
                  <td data-row="2" data-col="2">(0.024)</td>
                  <td data-row="2" data-col="3">(0.104)</td>
                </tr>
<tr>
<td data-row="3" data-col="1">RMSE</td>
                  <td data-row="3" data-col="2">1.91</td>
                  <td data-row="3" data-col="3"></td>
                </tr>
<tr>
<td data-row="4" data-col="1">Std.Errors</td>
                  <td data-row="4" data-col="2">by: b_block</td>
                  <td data-row="4" data-col="3"></td>
                </tr>
<tr>
<td data-row="5" data-col="1">H0</td>
                  <td data-row="5" data-col="2"></td>
                  <td data-row="5" data-col="3">b_treat=0</td>
                </tr>
<tr>
<td data-row="6" data-col="1">Num.Reps</td>
                  <td data-row="6" data-col="2"></td>
                  <td data-row="6" data-col="3">5000</td>
                </tr>
<tr>
<td data-row="7" data-col="1">Strata</td>
                  <td data-row="7" data-col="2"></td>
                  <td data-row="7" data-col="3">b_pair</td>
                </tr>
<tr>
<td data-row="8" data-col="1">Clusters</td>
                  <td data-row="8" data-col="2"></td>
                  <td data-row="8" data-col="3">b_block</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="section level3">
<h3 id="formulas">Formulas<a class="anchor" aria-label="anchor" href="#formulas"></a>
</h3>
<p>Formula interfaces are supported if you don’t like writing variables
(i.e. the <code>resampvar</code> and/or <code>strata</code> and
<code>cluster</code> arguments) as strings. I’ll just use the default
number of reps (i.e. 100) and drop the random seed for this next
example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">co_est</span>, <span class="op">~</span><span class="va">b_treat</span>, strata<span class="op">=</span><span class="op">~</span><span class="va">b_pair</span>, cluster<span class="op">=</span><span class="op">~</span><span class="va">b_block</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt;           Call: </span>feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">   Res. var(s): </span>b_treat</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">            H0: </span>b_treat=0</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;"> Strata var(s): </span>b_pair</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">        Strata: </span>31</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Cluster var(s): </span>b_block</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">      Clusters: </span>63</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">     Num. reps: </span>100</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span></span>
<span><span class="co">#&gt;  -0.1807        12       100      0.12   0.05372   0.03164    0.2084  </span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span></span>
<span><span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span></span>
<span><span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ggplot2">ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2"></a>
</h3>
<p>If you don’t like the default plot method and would prefer to use
<strong>ggplot2</strong>, then that’s easily done. Just extract the beta
values from the return object.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>betas <span class="op">=</span> <span class="va">co_ri</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ritest_files/figure-html/ggplot2_co_ri-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="piping-workflows">Piping workflows<a class="anchor" aria-label="anchor" href="#piping-workflows"></a>
</h3>
<p>The <strong>ritest</strong> package is fully compatible with piping
workflows. This might be useful if you don’t feel like saving
intermediate objects. Uncomment the code chunk below to see an example
using the new base R pipe (<code>|&gt;</code>) that was introduced in R
4.1.0. But the same principal would carry over to popular magrittr pipe
(<code>%&gt;%</code>).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Uncomment and run this code if you have R 4.1 or above</span></span>
<span><span class="co"># feols(yield ~ N + P + K | block, vcov = 'iid', data = npk) |&gt; # model</span></span>
<span><span class="co">#   ritest('N', strata = 'block', reps = 1e3, seed = 99L) |&gt;      # ritest</span></span>
<span><span class="co">#   plot()                                                        # plot</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
