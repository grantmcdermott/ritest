<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to ritest • ritest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ritest">
<meta property="og:description" content="ritest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ritest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ritest.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/grantmcdermott/ritest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ritest_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="ritest_files/kePrint-0.0.1/kePrint.js"></script><link href="ritest_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to ritest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/ritest/blob/master/vignettes/ritest.Rmd"><code>vignettes/ritest.Rmd</code></a></small>
      <div class="hidden name"><code>ritest.Rmd</code></div>

    </div>

    
    
<p>Let’s start by loading the <strong>ritest</strong> package. I’ll also be using one or two outside packages in the examples that follow to demonstrate some additional functionality, but will hold off loading those for now.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grantmcdermott/ritest">ritest</a></span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/ritest.html">ritest()</a></code> function supports a variety of arguments, but the basic syntax is</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">resampvar</span>, reps<span class="op">=</span><span class="fl">100</span>, strata<span class="op">=</span><span class="cn">NULL</span>, cluster<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
<p>where:</p>
<ul>
<li>
<code>object</code> is a model object (e.g. a linear regression).</li>
<li>
<code>resampvar</code> is the variable that you want to resample (i.e. permute). You can also specify the sharp null hypothesis that you want to test as part of a character string.</li>
<li>
<code>reps</code> is the number of simulations (i.e. permutations).</li>
<li>
<code>strata</code> is a variable defining the stratification (aka “blocking”) of the experimental design, if any.</li>
<li>
<code>cluster</code> is a variable defining the clustering of treatment in the experimental design, if any.</li>
<li>
<code>...</code> are other arguments. This includes the ability to set a random seed for reproducibility, controlling the parallelism behaviour, adding a progress bar, etc. See <code><a href="../reference/ritest.html">?ritest</a></code> for more information.</li>
</ul>
<p>Let’s see this functionality in action with the help of some examples.</p>
<div id="example-i-toy-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-i-toy-data" class="anchor"></a>Example I: Toy data</h2>
<p>Our first example will be a rather naive implementation using the base <a href="https://vincentarelbundock.github.io/Rdatasets/doc/MASS/npk.html"><code>nkp</code></a> dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">K</span>, data <span class="op">=</span> <span class="va">npk</span><span class="op">)</span></code></pre></div>
<p>Let’s say we’re interested in the yield effect of ‘N’ (i.e. nitrogen). We want to know whether our inferential reasoning about this parameter is robust to using RI, as opposed to just relying on the parametric t-test and p-value produced by our linear regression model. We’ll do 1,000 simulations and, just for illustration, limit the number of parallel cores to 2. (The default parallel behaviour will use half of the available cores on a user’s machine.) The ‘verbose = TRUE’ argument simply prints the results upon completion, including the original regression model summary.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_ri</span> <span class="op">=</span> <span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">'N'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Running 1000 parallel RI simulations as forked processes across 2 CPU cores.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ******************</span>
<span class="co">#&gt; * ORIGINAL MODEL *</span>
<span class="co">#&gt; ******************</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = yield ~ N + P + K, data = npk)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -9.2667 -3.6542  0.7083  3.4792  9.3333 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   54.650      2.205  24.784   &lt;2e-16 ***</span>
<span class="co">#&gt; N1             5.617      2.205   2.547   0.0192 *  </span>
<span class="co">#&gt; P1            -1.183      2.205  -0.537   0.5974    </span>
<span class="co">#&gt; K1            -3.983      2.205  -1.806   0.0859 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 5.401 on 20 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.3342, Adjusted R-squared:  0.2343 </span>
<span class="co">#&gt; F-statistic: 3.346 on 3 and 20 DF,  p-value: 0.0397</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ******************</span>
<span class="co">#&gt; * RITEST RESULTS *</span>
<span class="co">#&gt; ******************</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Call: lm(formula = yield ~ N + P + K, data = npk)</span>
<span class="co">#&gt;    Res. var(s): N1</span>
<span class="co">#&gt;             H0: N1=0</span>
<span class="co">#&gt;      Num. reps: 1000</span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class="co">#&gt;    5.617        21      1000     0.021  0.007462  0.008726   0.03327  </span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span>
<span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></code></pre></div>
<p>In this simple case, our parametric results appear to hold up very well. The original p-value of 0.019 is very close to the equivalent rejection rate of 0.021 that we get with our RI procedure.</p>
<p>We can also visualize this result using the dedicated <code>plot</code> method. The function takes several arguments for added customization. But here I’ll just show the default plot, which includes vertical lines that denote the simulated (in this case: 95 percent) rejection regions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">est_ri</span><span class="op">)</span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_est_ri-1.png" width="700"></p>
<p>As an aside, note that the RI procedure tests against a standard two-sided null hypothesis of zero. (In the above case: <code>H0: N1=0</code>.) We can specify a different null hypothesis as part of the <code>resampvar</code> string. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">'N&lt;=2'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_est_ri_alt_ho-1.png" width="700"></p>
<p>Note that we could (and probably should) have estimated a more realistic model that controls for the stratified (aka “blocked”) design of the original <code>npk</code> experiment. This is easily done, but we’ll hold off doing so for now since the the discussion of strata provides a nice segue to our next example.</p>
</div>
<div id="example-ii-real-life-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-ii-real-life-data" class="anchor"></a>Example II: Real-life data</h2>
<p>Our second example will provide a more realistic use-case, where we need to account for a <em>stratified</em> and <em>clustered</em> research design. In particular, we’ll replicate a real-life experiment that David McKenzie describes in a very helpful <a href="https://blogs.worldbank.org/impactevaluations/finally-way-do-easy-randomization-inference-stata">blog post</a> on the original Stata <code>-ritest-</code> routine.</p>
<p>The dataset in question derives from a randomized control trial about supply chains in Colombia, which David has kindly provided for re-use in this package (see: <code><a href="../reference/colombia.html">?colombia</a></code>). The key research question that we’re trying to answer below is whether a treatment intervention (<code>b_treat</code>) led to a drop in the number of days requiring visits to the <em>Corabastos</em> central market.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Moreover, we want to know if our inference about this treatment effect is robust to RI.</p>
<div id="stata-implementation" class="section level3">
<h3 class="hasAnchor">
<a href="#stata-implementation" class="anchor"></a>Stata implementation</h3>
<p>As a benchmark, first we recapitulate David’s Stata code and output. I won’t go into details — the essential thing to know is that I’m going to run 5,000 RI permutations on a pretty standard fixed-effect model, whilst accounting for the stratified and clustered design of the experiment.</p>
<p>(Aside: I’m also snipping most of the Stata output, so as to only highlight the main command and result.)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1"></a>. <span class="co">// This next line assumes you have exported the `colombia` dataset from R as a</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>. <span class="co">// CSV for Stata to read, e.g. `write.csv(colombia, '~/colombia.csv', row.names = FALSE)`</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>. <span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"~/colombia.csv"</span>, <span class="kw">comma</span> <span class="kw">clear</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>. </span>
<span id="cb7-6"><a href="#cb7-6"></a>. <span class="kw">timer</span> <span class="kw">on</span> 1</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>. </span>
<span id="cb7-9"><a href="#cb7-9"></a>. ritest b_treat _b[b_treat], <span class="kw">cluster</span>(b_block) <span class="kw">strata</span>(b_pair) reps(5e3) <span class="dv">seed</span>(546): <span class="co">///</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>&gt; <span class="kw">areg</span> dayscorab b_treat b_dayscorab miss_b_dayscorab round2 round3, <span class="kw">cluster</span>(b_block) a(b_pair)</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a>[snipped]</span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a>      command:  <span class="kw">areg</span> dayscorab b_treat b_dayscorab miss_b_dayscorab round2 round3, <span class="kw">cluster</span>(b_block)</span>
<span id="cb7-16"><a href="#cb7-16"></a>                    a(b_pair)</span>
<span id="cb7-17"><a href="#cb7-17"></a>        _pm_1:  _b[b_treat]</span>
<span id="cb7-18"><a href="#cb7-18"></a>  res. <span class="kw">var</span>(<span class="fu">s</span>):  b_treat</span>
<span id="cb7-19"><a href="#cb7-19"></a>   Resampling:  Permuting b_treat</span>
<span id="cb7-20"><a href="#cb7-20"></a>Clust. <span class="kw">var</span>(<span class="fu">s</span>):  b_block</span>
<span id="cb7-21"><a href="#cb7-21"></a>     Clusters:  63</span>
<span id="cb7-22"><a href="#cb7-22"></a>Strata <span class="kw">var</span>(<span class="fu">s</span>):  b_pair</span>
<span id="cb7-23"><a href="#cb7-23"></a>       Strata:  31</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a>------------------------------------------------------------------------------</span>
<span id="cb7-26"><a href="#cb7-26"></a>T            |     T(<span class="kw">obs</span>)       c       n   <span class="kw">p</span>=c/n   <span class="kw">SE</span>(<span class="kw">p</span>) [95% Conf. Interval]</span>
<span id="cb7-27"><a href="#cb7-27"></a>-------------+----------------------------------------------------------------</span>
<span id="cb7-28"><a href="#cb7-28"></a>       _pm_1 |   -.180738     529    5000  0.1058  0.0043  .0974064   .1146569</span>
<span id="cb7-29"><a href="#cb7-29"></a>------------------------------------------------------------------------------</span>
<span id="cb7-30"><a href="#cb7-30"></a>Note: Confidence interval is with respect to <span class="kw">p</span>=c/n.</span>
<span id="cb7-31"><a href="#cb7-31"></a>Note: c = #{|T| &gt;= |T(<span class="kw">obs</span>)|}</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a>. </span>
<span id="cb7-34"><a href="#cb7-34"></a>. <span class="kw">timer</span> <span class="kw">off</span> 1</span></code></pre></div>
<p>Like David, this takes around <strong>3 minutes</strong> to run on my laptop.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1"></a>. <span class="kw">timer</span> <span class="ot">list</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>   1:    183.01 /        1 =     183.0150</span></code></pre></div>
</div>
<div id="r-implementation" class="section level3">
<h3 class="hasAnchor">
<a href="#r-implementation" class="anchor"></a>R implementation</h3>
<p>Let’s replicate the above in R using this package. First, we’ll estimate and save the parametric model using <code><a href="https://lrberge.github.io/fixest/reference/feols.html">fixest::feols()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"colombia"</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span> <span class="co">## For fast (high-dimensional) fixed-effects models</span>

<span class="va">co_est</span> <span class="op">=</span> 
  <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html">feols</a></span><span class="op">(</span>
    <span class="va">dayscorab</span> <span class="op">~</span> <span class="va">b_treat</span> <span class="op">+</span> <span class="va">b_dayscorab</span> <span class="op">+</span> <span class="va">miss_b_dayscorab</span> <span class="op">|</span> <span class="va">b_pair</span> <span class="op">+</span> <span class="va">round2</span> <span class="op">+</span> <span class="va">round3</span>, 
    vcov <span class="op">=</span> <span class="op">~</span><span class="va">b_block</span>, data <span class="op">=</span> <span class="va">colombia</span>
    <span class="op">)</span>
<span class="co">#&gt; NOTE: 1,020 observations removed because of NA values (LHS: 1,020).</span>
<span class="va">co_est</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: dayscorab</span>
<span class="co">#&gt; Observations: 2,346 </span>
<span class="co">#&gt; Fixed-effects: b_pair: 31,  round2: 2,  round3: 2</span>
<span class="co">#&gt; Standard-errors: Clustered (b_block) </span>
<span class="co">#&gt;                   Estimate Std. Error  t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; b_treat          -0.180738   0.078174 -2.31201  0.024113 *  </span>
<span class="co">#&gt; b_dayscorab       0.524761   0.029423 17.83478 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; miss_b_dayscorab  0.603928   0.264174  2.28610  0.025678 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 1.91167     Adj. R2: 0.282038</span>
<span class="co">#&gt;                 Within R2: 0.266002</span></code></pre></div>
<p>Now, we conduct RI on our model to see whether our key treatment variable (<code>b_treat</code>) is sensitive to the imposed parametric constraints. Note that we can specify the strata and clusters as additional arguments to <code><a href="../reference/ritest.html">ritest()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tic</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="co">## timer on</span>

<span class="va">co_ri</span> <span class="op">=</span> <span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">co_est</span>, <span class="st">'b_treat'</span>, cluster<span class="op">=</span><span class="st">'b_block'</span>, strata<span class="op">=</span><span class="st">'b_pair'</span>, reps<span class="op">=</span><span class="fl">5e3</span>, seed<span class="op">=</span><span class="fl">546L</span><span class="op">)</span>

<span class="va">toc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">tic</span> <span class="co">## timer off</span>

<span class="co">## Print the results</span>
<span class="va">co_ri</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Call: feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span>
<span class="co">#&gt;    Res. var(s): b_treat</span>
<span class="co">#&gt;             H0: b_treat=0</span>
<span class="co">#&gt;  Strata var(s): b_pair</span>
<span class="co">#&gt;         Strata: 31</span>
<span class="co">#&gt; Cluster var(s): b_block</span>
<span class="co">#&gt;       Clusters: 63</span>
<span class="co">#&gt;      Num. reps: 5000</span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class="co">#&gt;  -0.1807       520      5000     0.104  0.007102   0.09232    0.1157  </span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span>
<span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></code></pre></div>
<p>Using the same random seed in R and Stata is a bit of performance art. We won’t get exactly the same results across two different languages. But the important thing to note is that they are functionally equivalent (rejection probability of 0.106 vs 0.104). More importantly, we can see that our inference about the effectiveness of treatment in this study is indeed sensitive to RI. Our parametric p-value (0.024) is much lower than the permuted rejection rate (0.104).</p>
<p>Again, we can plot the results. Here’s a slight variation, where we plot in histogram form and use a fill to highlight the 95% rejection region(s) instead of vertical lines.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">co_ri</span>, type <span class="op">=</span> <span class="st">'hist'</span>, highlight <span class="op">=</span> <span class="st">'fill'</span><span class="op">)</span></code></pre></div>
<p><img src="ritest_files/figure-html/plot_co_ri-1.png" width="700"></p>
</div>
<div id="benchmarks" class="section level3">
<h3 class="hasAnchor">
<a href="#benchmarks" class="anchor"></a>Benchmarks</h3>
<p>One nice feature of the R implementation is that it should complete very quickly. Instead of taking 3 minutes, this time the 5,000 simulations only take around <strong>6 seconds</strong>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toc</span>
<span class="co">#&gt; Time difference of 6.581697 secs</span></code></pre></div>
<p>As a general observation, the R implementation of <code><a href="../reference/ritest.html">ritest()</a></code> doesn’t yet offer all of the functionality of the Stata version. For example, it doesn’t support an external file of resampling weights. However, it does appear to be a lot (25x – 50x) faster and this might make it more suitable for certain types of problems.</p>
</div>
</div>
<div id="extras-and-asides" class="section level2">
<h2 class="hasAnchor">
<a href="#extras-and-asides" class="anchor"></a>Extras and asides</h2>
<div id="regression-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-tables" class="anchor"></a>Regression tables</h3>
<p>Support for regression tables is enabled via <strong>ritest’s</strong> compatability with the <strong>modelsummary</strong> package. I recommend displaying p-values instead of the default standard errors. This is particularly important when comparing against a parametric model, as I do below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>

<span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="va">co_est</span>, ritest <span class="op">=</span> <span class="va">co_ri</span><span class="op">)</span>, 
         statistic <span class="op">=</span> <span class="st">'p.value'</span>, 
         <span class="co">## These next arguments just make our comparison table look a bit nicer</span>
         coef_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'b_treat'</span> <span class="op">=</span> <span class="st">'Treatment'</span><span class="op">)</span>, 
         gof_omit <span class="op">=</span> <span class="st">'Obs|R2|IC|Log|F'</span>,
         notes <span class="op">=</span> <span class="st">'p-values shown in parentheses.'</span><span class="op">)</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
lm
</th>
<th style="text-align:center;">
ritest
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:center;">
−0.181
</td>
<td style="text-align:center;">
−0.181
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.024)
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.104)
</td>
</tr>
<tr>
<td style="text-align:left;">
Std.Errors
</td>
<td style="text-align:center;">
by: b_block
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
H0
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
b_treat=0
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Reps
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
5000
</td>
</tr>
<tr>
<td style="text-align:left;">
Strata
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
b_pair
</td>
</tr>
<tr>
<td style="text-align:left;">
Clusters
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
b_block
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> p-values shown in parentheses.
</td>
</tr></tfoot>
</table>
</div>
<div id="formulas" class="section level3">
<h3 class="hasAnchor">
<a href="#formulas" class="anchor"></a>Formulas</h3>
<p>Formula interfaces are supported if you don’t like writing variables (i.e. the <code>resampvar</code> and/or <code>strata</code> and <code>cluster</code> arguments) as strings. I’ll just use the default number of reps (i.e. 100) and drop the random seed for this next example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="va">co_est</span>, <span class="op">~</span><span class="va">b_treat</span>, strata<span class="op">=</span><span class="op">~</span><span class="va">b_pair</span>, cluster<span class="op">=</span><span class="op">~</span><span class="va">b_block</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Call: feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span>
<span class="co">#&gt;    Res. var(s): b_treat</span>
<span class="co">#&gt;             H0: b_treat=0</span>
<span class="co">#&gt;  Strata var(s): b_pair</span>
<span class="co">#&gt;         Strata: 31</span>
<span class="co">#&gt; Cluster var(s): b_block</span>
<span class="co">#&gt;       Clusters: 63</span>
<span class="co">#&gt;      Num. reps: 100</span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt;   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class="co">#&gt;  -0.1807         8       100      0.08   0.04485  0.006231    0.1538  </span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note: Confidence interval is with respect to p=c/n. </span>
<span class="co">#&gt; Note: c = #{|T| &gt;= |T(obs)|}</span></code></pre></div>
</div>
<div id="ggplot2" class="section level3">
<h3 class="hasAnchor">
<a href="#ggplot2" class="anchor"></a>ggplot2</h3>
<p>If you don’t like the default plot method and would prefer to use <strong>ggplot2</strong>, then that’s easily done. Just extract the beta values from the return object.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>betas <span class="op">=</span> <span class="va">co_ri</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="ritest_files/figure-html/ggplot2_co_ri-1.png" width="700"></p>
</div>
<div id="piping-workflows" class="section level3">
<h3 class="hasAnchor">
<a href="#piping-workflows" class="anchor"></a>Piping workflows</h3>
<p>The <strong>ritest</strong> package is fully compatible with piping workflows. This might be useful if you don’t feel like saving intermediate objects. Here I’ll demonstrate using the new base R pipe (<code>|&gt;</code>) that was introduced in R 4.1.0, but the same principal would carry over to popular magrittr pipe (<code>%&gt;%</code>).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Only run this code if you have R 4.1 or above</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">getRversion</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"4.1"</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html">feols</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">K</span> <span class="op">|</span> <span class="va">block</span>, vcov <span class="op">=</span> <span class="st">'iid'</span>, data <span class="op">=</span> <span class="va">npk</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/ritest.html">ritest</a></span><span class="op">(</span><span class="st">'N'</span>, strata <span class="op">=</span> <span class="st">'block'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">99L</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="ritest_files/figure-html/est2_pipe-1.png" width="700"></p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Repeated visits to the market are an expensive and time-consuming exercise for the fresh produce vendors that formed the study population.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
