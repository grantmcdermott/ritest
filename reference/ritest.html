<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Perform randomization inference on a model object — ritest • ritest</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Perform randomization inference on a model object — ritest" />
<meta property="og:description" content="Perform randomization inference (RI) testing on a model object, e.g. a
  coefficient from a linear regression model. It tries to mimic the `-ritest-`
  Stata routine (Heß, 2017) in its design and functionality. The package is
  quite experimental and only a subset of this functionality is currently
  supported. However, it does appear to be significantly faster." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ritest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ritest.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/grantmcdermott/ritest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform randomization inference on a model object</h1>
    <small class="dont-index">Source: <a href='https://github.com/grantmcdermott/ritest/blob/master/R/ritest.R'><code>R/ritest.R</code></a></small>
    <div class="hidden name"><code>ritest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform randomization inference (RI) testing on a model object, e.g. a
  coefficient from a linear regression model. It tries to mimic the `-ritest-`
  Stata routine (Heß, 2017) in its design and functionality. The package is
  quite experimental and only a subset of this functionality is currently
  supported. However, it does appear to be significantly faster.</p>
    </div>

    <pre class="usage"><span class='fu'>ritest</span><span class='op'>(</span>
  <span class='va'>object</span>,
  <span class='va'>resampvar</span>,
  reps <span class='op'>=</span> <span class='fl'>100</span>,
  strata <span class='op'>=</span> <span class='cn'>NULL</span>,
  cluster <span class='op'>=</span> <span class='cn'>NULL</span>,
  level <span class='op'>=</span> <span class='fl'>0.95</span>,
  parallel <span class='op'>=</span> <span class='cn'>TRUE</span>,
  ptype <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"auto"</span>, <span class='st'>"fork"</span>, <span class='st'>"psock"</span><span class='op'>)</span>,
  pcores <span class='op'>=</span> <span class='cn'>NULL</span>,
  stack <span class='op'>=</span> <span class='cn'>NULL</span>,
  stack_lim <span class='op'>=</span> <span class='fl'>1L</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  pb <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>Model object containing the `resampvar` variable. At present,
only `stats::lm` and `fixest::feols` models are supported.</p></td>
    </tr>
    <tr>
      <th>resampvar</th>
      <td><p>Character or one-sided formula. The variable (coefficient)
that you want to test.
By default, the RI procedure will conduct a standard two-sided test against
a sharp null hypothesis of zero (i.e. H0: resampvar = 0). Other null
hypotheses may be specified as part of a character string. These must
take the form of the resampled variable, followed by an (in)equality sign,
and then a number. For example 'x&gt;=0' or 'x&lt;=0' would yield respective
one-sided tests against the zero null. Similarly, you can test against
values other than zero (e.g. 'x=1' or x&gt;=1). However, note that multiple
multiple comparison tests (e.g. 'x1-x2=0') are not yet supported. See
Examples.</p></td>
    </tr>
    <tr>
      <th>reps</th>
      <td><p>Integer. The number of repetitions (permutation draws) in the RI
simulation. Default is 100, but you probably want more that that. Young
(2019) finds that rejection rates stabilise at around 2,000 draws.</p></td>
    </tr>
    <tr>
      <th>strata</th>
      <td><p>Character or one-sided formula. Permute `resampvar` within
strata (AKA blocks)? See Details and Examples below.</p></td>
    </tr>
    <tr>
      <th>cluster</th>
      <td><p>Character or one-sided formula. Keep `resampvar` constant
within clusters? See Details and Examples below.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>Numeric. The desired confidence level. Default if 0.95.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Logical. Should the permuted fits be executed in parallel?
Default is TRUE, with additional options being passed to the `ptype` and
`pcores` arguments.</p></td>
    </tr>
    <tr>
      <th>ptype</th>
      <td><p>Character. What type of parallel strategy should be used? The
default behaviour on Linux and Mac is parallel forking ("fork"), while on
Windows it will revert to parallel sockets ("psock"). Note that forking
is more efficient, but unavailable on Windows.</p></td>
    </tr>
    <tr>
      <th>pcores</th>
      <td><p>Integer. How many parallel cores should be used? If none is
provided, then it will default to half of the total available CPU cores
on the user's machine.</p></td>
    </tr>
    <tr>
      <th>stack</th>
      <td><p>Logical. Should the permuted data be stacked in memory all at
once, rather than being recalculated during each iteration? Stacking takes
advantage of vectorisation and is thus more efficient. (It also helps to
ensure reproducibility when the results are being generated in parallel ---
see the note on random-number generation below.) But it does
require additional memory. If no explicit choice is provided, then the
function will automatically stack as long this implies an additional memory
overhead less than the `stack_lim` argument. (Note that stacking is only
relevant if at least one of `strata` or `cluster` are defined.)</p></td>
    </tr>
    <tr>
      <th>stack_lim</th>
      <td><p>Numeric. What is the memory limit (in gigabytes) for
determining whether the permuted data should be stacked in memory ahead of
time? Default is 1 GB.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Integer. Random seed for reproducible results. Note that the
choice of parallel behaviour can alter results even when using the same
seed. See the note on random number generation below.</p></td>
    </tr>
    <tr>
      <th>pb</th>
      <td><p>Logical. Display a progress bar? Default is FALSE. Note that
progress bars can add a surprising amount of computational overhead to
iterative functions. I've therefore set the number of updating steps
--- i.e. via the `nout` argument of [pbapply::pboptions()] --- to 5, which
should limit this kind of overhead in the event that a user invokes the
`pb = TRUE` argument.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical. Display the underlying model `object` summary and
`ritest` return value? Default is `FALSE`.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments. Currently ignored.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An list object of class `ritest`. Default print and plotting methods
  are supported.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function is experimental and functionality is still quite
  limited. Albeit, that it does support the most likely use case for RI on a
  regression model, i.e. permutation testing of a coefficient value. Present
  limitations include: only `lm` and `fixest::feols` model objects are
  supported; only one permutation (RI) test is allowed; and only one strata
  and/or cluster variable, respectively, can be supplied. I hope to resolve
  these limitations as time permits.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The use of parallelism in computation introduces some well-known
  complications with respect to random number generation (RNG). See the
  vignette accompanying the `parallel` package for more discussion. The
  `ritest()` function adopts various best practices to facilitate reliably
  reproducible results, irrespective of the choice of parallel strategy.
  These include the use of "L'Ecuyer-CMRG" RNG kind and the default behaviour
  of "stacking" the permuted results in memory before passing them on to the
  fitting stage of the randomization inference routine (where the fitting would
  still be done in parallel). To briefly dwell on the latter, note that this
  stacking behaviour is very similar to --- I nearly wrote "parallels" ---
  the approach adopted by `boot` and other packages that trade off RNG with
  parallelism and reproducibility. In the phrasing
  of the `parallel` vignette: "One way to avoid any difficulties is (where
  possible) to do all the randomization in the master process" (p. 5).</p>
<p>The upshot is that running `ritest()` under a given set of arguments should
  generally yield the same, reproducible results regardless of when or where
  they were run. This should be true even if users turn the default parallel
  behaviour of the function off or back on, or whether they change the
  `ptype` argument to "psock" or "fork" and back again. However, it cannot be
  guaranteed under every scenario. Perhaps the most obvious case is when
  `ritest()` is run without any declared strata or clusters. (Reason:
  Stacking in this simple case is turned off because it yields no efficiency
  gains.) In this case, the RNG stream will be sensitive to the _number_ of
  available cores on a user's computer. Two parallel cores will yield a
  slightly different result than four cores, or six cores, etc. Of course,
  users can always ensure perfect reproducibility by explicitly defining the
  number of required cores in the `ritest()` call via the `pcores` argument.
  Stepping back, the focus on reproducible exactitude rather misses the
  point in an exercise like randomization inference testing. Much more important is
  running enough permutation trials so that your rejection rates are stable
  and any minor differences due to different RNG seeds are moot. Remember,
  the ultimate goal of inference (and research) isn't simply to generate
  reproducible results under a very specific set of circumstances. Rather, it
  is to generate consistent insights that hold even under varying
  circumstances.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Simon Heß (2017). <cite>Robust Randomization inference with
  Stata: A guide and software</cite>, The Stata Journal, 17, Number 3, pp. 630--651</p>
<p>Alwyn Young (2019). <cite>Channeling Fisher: Randomization
  Tests and the Statistical Insignificance of Seemingly Significant
  Experimental Results</cite>, The Quarterly Journal of Economics, 134, Issue 2,
  pp. 557--598</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>[print.ritest()], [plot.ritest()]</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='co'>#</span></span>
<span class='r-in'><span class='co'>## Example 1: Basic functionality</span></span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># First estimate a simple linaer regression on the base 'npk' dataset. For</span></span>
<span class='r-in'><span class='co'># this first example, we won't worry about strata or clusters, or other</span></span>
<span class='r-in'><span class='co'># experimental design complications.</span></span>
<span class='r-in'><span class='va'>est</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>yield</span> <span class='op'>~</span> <span class='va'>N</span> <span class='op'>+</span> <span class='va'>P</span> <span class='op'>+</span> <span class='va'>K</span>, data <span class='op'>=</span> <span class='va'>npk</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Conduct RI on the 'N' (i.e. nitrogen) coefficient. We'll do 1,000</span></span>
<span class='r-in'><span class='co'># simulations and, just for illustration, limit the number of parallel cores</span></span>
<span class='r-in'><span class='co'># to 2 (default is half of the available cores). The 'verbose = TRUE'</span></span>
<span class='r-in'><span class='co'># argument simply prints the results upon completion, including the original</span></span>
<span class='r-in'><span class='co'># regression model summary.</span></span>
<span class='r-in'><span class='va'>est_ri</span> <span class='op'>=</span> <span class='fu'>ritest</span><span class='op'>(</span><span class='va'>est</span>, <span class='st'>'N'</span>, reps <span class='op'>=</span> <span class='fl'>1e3</span>, seed <span class='op'>=</span> <span class='fl'>1234L</span>, verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Running 1000 parallel RI simulations as forked processes across 1 CPU cores.</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ******************</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * ORIGINAL MODEL *</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ******************</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Call:</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> lm(formula = yield ~ N + P + K, data = npk)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Residuals:</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> -9.2667 -3.6542  0.7083  3.4792  9.3333 </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Coefficients:</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> (Intercept)   54.650      2.205  24.784   &lt;2e-16 ***</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> N1             5.617      2.205   2.547   0.0192 *  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> P1            -1.183      2.205  -0.537   0.5974    </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> K1            -3.983      2.205  -1.806   0.0859 .  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ---</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Residual standard error: 5.401 on 20 degrees of freedom</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Multiple R-squared:  0.3342,	Adjusted R-squared:  0.2343 </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> F-statistic: 3.346 on 3 and 20 DF,  p-value: 0.0397</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ******************</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * RITEST RESULTS *</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ******************</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>          Call: </span>lm(formula = yield ~ N + P + K, data = npk)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>   Res. var(s): </span>N1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>            H0: </span>N1=0</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>     Num. reps: </span>1000</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>    5.617        29      1000     0.029  0.008733   0.01464   0.04336  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: Confidence interval is with respect to p=c/n. </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: c = #{|T| &gt;= |T(obs)|} </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Result: The RI rejection rate (0.021) is very similar to the parametric</span></span>
<span class='r-in'><span class='co'># p-value (0.019).</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># We can plot the results and various options are available to customise the appearance.</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est_ri</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est_ri</span>, type <span class='op'>=</span> <span class='st'>'hist'</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># etc</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Aside: By default, ritest() conducts a standard two-sided test against a</span></span>
<span class='r-in'><span class='co'># sharp null hypothesis of zero. You can can specify other null hypotheses as</span></span>
<span class='r-in'><span class='co'># part of the 'resampvar' string argument. For example, a (left) one-sided</span></span>
<span class='r-in'><span class='co'># test...</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ritest</span><span class='op'>(</span><span class='va'>est</span>, <span class='st'>'N&lt;=0'</span>, reps <span class='op'>=</span> <span class='fl'>1e3</span>, seed <span class='op'>=</span> <span class='fl'>1234L</span>, pcores <span class='op'>=</span> <span class='fl'>2L</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-3.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># ... or, null values different from zero.</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ritest</span><span class='op'>(</span><span class='va'>est</span>, <span class='st'>'N=2'</span>, reps <span class='op'>=</span> <span class='fl'>1e3</span>, seed <span class='op'>=</span> <span class='fl'>1234L</span>, pcores <span class='op'>=</span> <span class='fl'>2L</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-4.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'><span class='co'>## Example 2: Real-life example</span></span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Now that we've seen the basic functionality, here's a more realistic RI</span></span>
<span class='r-in'><span class='co'># example using data from a randomized control trial conducted in Colombia.</span></span>
<span class='r-in'><span class='co'># More details on the dataset -- kindly provided by the study authors -- can</span></span>
<span class='r-in'><span class='co'># be found in the accompanying helpfile ("?colombia"). The most important</span></span>
<span class='r-in'><span class='co'># thing to note is that we need to control for the stratified (aka "blocked")</span></span>
<span class='r-in'><span class='co'># and clustered experimental design.</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"colombia"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># We'll use the fixest package to estimate our parametric regression model,</span></span>
<span class='r-in'><span class='co'># specifying the strata (here: treatment-control pairs) as fixed-effects and</span></span>
<span class='r-in'><span class='co'># clustering the standard errors by location (here: city blocks).</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lrberge.github.io/fixest/'>fixest</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>co_est</span> <span class='op'>=</span> <span class='fu'><a href='https://lrberge.github.io/fixest/reference/feols.html'>feols</a></span><span class='op'>(</span><span class='va'>dayscorab</span> <span class='op'>~</span> <span class='va'>b_treat</span> <span class='op'>+</span> <span class='va'>b_dayscorab</span> <span class='op'>+</span> <span class='va'>miss_b_dayscorab</span> <span class='op'>|</span></span>
<span class='r-in'>                 <span class='va'>b_pair</span> <span class='op'>+</span> <span class='va'>round2</span> <span class='op'>+</span> <span class='va'>round3</span>,</span>
<span class='r-in'>               vcov <span class='op'>=</span> <span class='op'>~</span><span class='va'>b_block</span>, data <span class='op'>=</span> <span class='va'>colombia</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> NOTE: 1,020 observations removed because of NA values (LHS: 1,020).</span>
<span class='r-in'><span class='va'>co_est</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> OLS estimation, Dep. Var.: dayscorab</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Observations: 2,346 </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Fixed-effects: b_pair: 31,  round2: 2,  round3: 2</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Standard-errors: Clustered (b_block) </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>                   Estimate Std. Error  t value  Pr(&gt;|t|)    </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> b_treat          -0.180738   0.078174 -2.31201  0.024113 *  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> b_dayscorab       0.524761   0.029423 17.83478 &lt; 2.2e-16 ***</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> miss_b_dayscorab  0.603928   0.264174  2.28610  0.025678 *  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ---</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> RMSE: 1.91167     Adj. R2: 0.282038</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>                 Within R2: 0.266002</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Run RI on the 'b_treat' variable, specifying the strata and clusters.</span></span>
<span class='r-in'><span class='va'>co_ri</span> <span class='op'>=</span> <span class='fu'>ritest</span><span class='op'>(</span><span class='va'>co_est</span>, <span class='st'>'b_treat'</span>, strata<span class='op'>=</span><span class='st'>'b_pair'</span>, cluster<span class='op'>=</span><span class='st'>'b_block'</span>,</span>
<span class='r-in'>               reps<span class='op'>=</span><span class='fl'>1e3</span>, seed<span class='op'>=</span><span class='fl'>123L</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>co_ri</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>          Call: </span>feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>   Res. var(s): </span>b_treat</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>            H0: </span>b_treat=0</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'> Strata var(s): </span>b_pair</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>        Strata: </span>31</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>Cluster var(s): </span>b_block</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>      Clusters: </span>63</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>     Num. reps: </span>1000</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  -0.1807       110      1000      0.11   0.01628   0.08322    0.1368  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: Confidence interval is with respect to p=c/n. </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: c = #{|T| &gt;= |T(obs)|} </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>co_ri</span>, type <span class='op'>=</span> <span class='st'>'hist'</span>, highlight <span class='op'>=</span> <span class='st'>'fill'</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-5.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># This time, the RI rejection rate (0.11) is noticeably higher than the</span></span>
<span class='r-in'><span class='co'># parametric p-value (0.024) from the regression model.</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'><span class='co'>## Some more asides...</span></span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Formula interfaces are supported if you don't like writing variables (i.e.</span></span>
<span class='r-in'><span class='co'># the treatment and/or strata and cluster arguments) as strings.</span></span>
<span class='r-in'><span class='fu'>ritest</span><span class='op'>(</span><span class='va'>co_est</span>, <span class='op'>~</span><span class='va'>b_treat</span>, strata<span class='op'>=</span><span class='op'>~</span><span class='va'>b_pair</span>, cluster<span class='op'>=</span><span class='op'>~</span><span class='va'>b_block</span>, reps<span class='op'>=</span><span class='fl'>1e3</span>, seed<span class='op'>=</span><span class='fl'>123L</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>          Call: </span>feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>   Res. var(s): </span>b_treat</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>            H0: </span>b_treat=0</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'> Strata var(s): </span>b_pair</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>        Strata: </span>31</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>Cluster var(s): </span>b_block</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>      Clusters: </span>63</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> <span style='font-weight: bold;'>     Num. reps: </span>1000</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  -0.1807       110      1000      0.11   0.01628   0.08322    0.1368  </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: Confidence interval is with respect to p=c/n. </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Note: c = #{|T| &gt;= |T(obs)|} </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># If you don't like the default plot method and would prefer to use ggplot2,</span></span>
<span class='r-in'><span class='co'># then that's easily done. Just extract the beta values from the return object.</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>betas <span class='op'>=</span> <span class='va'>co_ri</span><span class='op'>$</span><span class='va'>betas</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>betas</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='ritest-6.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Exporting to a regression table can be done via the modelsummary package.</span></span>
<span class='r-in'><span class='co'># It is recommended that you explicitly ask for p-values rather than standard</span></span>
<span class='r-in'><span class='co'># errors (the default), especially if you want to compare with the parametric</span></span>
<span class='r-in'><span class='co'># results of the original model. Uncomment these next lines if you would like</span></span>
<span class='r-in'><span class='co'># to see for yourself.</span></span>
<span class='r-in'><span class='co'># library(modelsummary)</span></span>
<span class='r-in'><span class='co'># msummary(list(ols=co_est, ritest=co_ri), statistic = 'p.value',</span></span>
<span class='r-in'><span class='co'>#          coef_map = c('b_treat' = 'Treatment'), gof_omit = 'Obs|R2|IC|Log|F',</span></span>
<span class='r-in'><span class='co'>#          notes = 'p-values shown in parentheses.')</span></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


