<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Perform randomization inference on a model object — ritest • ritest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perform randomization inference on a model object — ritest"><meta name="description" content="Perform randomization inference (RI) testing on a model object, e.g. a
  coefficient from a linear regression model. It tries to mimic the `-ritest-`
  Stata routine (Heß, 2017) in its design and functionality. The package is
  quite experimental and only a subset of this functionality is currently
  supported. However, it does appear to be significantly faster."><meta property="og:description" content="Perform randomization inference (RI) testing on a model object, e.g. a
  coefficient from a linear regression model. It tries to mimic the `-ritest-`
  Stata routine (Heß, 2017) in its design and functionality. The package is
  quite experimental and only a subset of this functionality is currently
  supported. However, it does appear to be significantly faster."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ritest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ritest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/grantmcdermott/ritest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Perform randomization inference on a model object</h1>
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/ritest/blob/main/R/ritest.R" class="external-link"><code>R/ritest.R</code></a></small>
      <div class="d-none name"><code>ritest.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform randomization inference (RI) testing on a model object, e.g. a
  coefficient from a linear regression model. It tries to mimic the `-ritest-`
  Stata routine (Heß, 2017) in its design and functionality. The package is
  quite experimental and only a subset of this functionality is currently
  supported. However, it does appear to be significantly faster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ritest</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">resampvar</span>,</span>
<span>  reps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"fork"</span>, <span class="st">"psock"</span><span class="op">)</span>,</span>
<span>  pcores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stack <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stack_lim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pb <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Model object containing the `resampvar` variable. At present,
only `stats::lm` and `fixest::feols` models are supported.</p></dd>


<dt id="arg-resampvar">resampvar<a class="anchor" aria-label="anchor" href="#arg-resampvar"></a></dt>
<dd><p>The variable (coefficient) that you want to perform RI on.
Can be provided as a bare (unquoted) variable name, a character string, or
a one-sided formula.
By default, the RI procedure will conduct a standard two-sided test against
a sharp null hypothesis of zero (i.e. H0: resampvar = 0). Other null
hypotheses may be specified as part of a character string. These must
take the form of the resampled variable, followed by an (in)equality sign,
and then a number. For example 'x&gt;=0' or 'x&lt;=0' would yield respective
one-sided tests against the zero null. Similarly, you can test against
values other than zero (e.g. 'x=1' or 'x&gt;=1'). However, note that multiple
multiple comparison tests (e.g. 'x1-x2=0') are not yet supported. See
Examples.</p></dd>


<dt id="arg-reps">reps<a class="anchor" aria-label="anchor" href="#arg-reps"></a></dt>
<dd><p>Integer. The number of repetitions (permutation draws) in the RI
simulation. Default is 100, but you probably want more that that. Young
(2019) finds that rejection rates stabilise at around 2,000 draws.</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>Permute `resampvar` within strata (AKA blocks)? Can be
provided as a bare variable name, character string, or one-sided formula.
See Details and Examples below.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>Keep `resampvar` constant within clusters? Can be provided as
a bare variable name, character string, or one-sided formula. See Details
and Examples below.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>Numeric. The desired confidence level. Default if 0.95.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical. Should the permuted fits be executed in parallel?
Default is TRUE, with additional options being passed to the `ptype` and
`pcores` arguments.</p></dd>


<dt id="arg-ptype">ptype<a class="anchor" aria-label="anchor" href="#arg-ptype"></a></dt>
<dd><p>Character. What type of parallel strategy should be used? The
default behaviour on Linux and Mac is parallel forking ("fork"), while on
Windows it will revert to parallel sockets ("psock"). Note that forking
is more efficient, but unavailable on Windows.</p></dd>


<dt id="arg-pcores">pcores<a class="anchor" aria-label="anchor" href="#arg-pcores"></a></dt>
<dd><p>Integer. How many parallel cores should be used? If none is
provided, then it will default to half of the total available CPU cores
on the user's machine.</p></dd>


<dt id="arg-stack">stack<a class="anchor" aria-label="anchor" href="#arg-stack"></a></dt>
<dd><p>Logical. Should the permuted data be stacked in memory all at
once, rather than being recalculated during each iteration? Stacking takes
advantage of vectorisation and is thus more efficient. (It also helps to
ensure reproducibility when the results are being generated in parallel —
see the note on random-number generation below.) But it does
require additional memory. If no explicit choice is provided, then the
function will automatically stack as long this implies an additional memory
overhead less than the `stack_lim` argument. Note that stacking is only
relevant if at least one of `strata` or `cluster` are defined.</p></dd>


<dt id="arg-stack-lim">stack_lim<a class="anchor" aria-label="anchor" href="#arg-stack-lim"></a></dt>
<dd><p>Numeric. What is the memory limit (in gigabytes) for
determining whether the permuted data should be stacked in memory ahead of
time? Default is 1 GB. You probably want to increase this if you are
working with a large dataset and have lots of RAM.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer. Random seed for reproducible results. Note that the
choice of parallel behaviour can alter results even when using the same
seed. See the Note on random number generation below.</p></dd>


<dt id="arg-pb">pb<a class="anchor" aria-label="anchor" href="#arg-pb"></a></dt>
<dd><p>Logical. Display a progress bar? Default is FALSE. Progress bars
can add a surprising amount of computational overhead to iterative
functions. I've therefore set the number of updating steps — i.e. via the
`nout` argument of [pbapply::pboptions()] — to 5, which should limit this
kind of overhead in the event that a user invokes the `pb = TRUE` argument.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Display the underlying model `object` summary and
`ritest` return value? Default is `FALSE`.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments. Currently ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An list object of class `ritest`. Default print and plotting methods
  are supported.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is experimental and functionality is still quite
  limited. Albeit, that it does support the most likely use case for RI on a
  regression model, i.e. permutation testing of a coefficient value. Present
  limitations include: only `lm` and `fixest::feols` model objects are
  supported; only one permutation (RI) test is allowed; and only one strata
  and/or cluster variable, respectively, can be supplied. I hope to resolve
  these limitations as time permits.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The use of parallelism in computation introduces some well-known
  complications with respect to random number generation (RNG). See the
  vignette accompanying the `parallel` package for more discussion. The
  `ritest()` function adopts various best practices to facilitate reliably
  reproducible results, irrespective of the choice of parallel strategy.
  These include the use of "L'Ecuyer-CMRG" RNG kind and the default behaviour
  of "stacking" the permuted results in memory before passing them on to the
  fitting stage of the randomization inference routine (where the fitting would
  still be done in parallel). To briefly dwell on the latter, note that this
  stacking behaviour is very similar to — I nearly wrote "parallels" —
  the approach adopted by `boot` and other packages that trade off RNG with
  parallelism and reproducibility. In the phrasing
  of the `parallel` vignette: "One way to avoid any difficulties is (where
  possible) to do all the randomization in the master process" (p. 5).</p>
<p>The upshot is that running `ritest()` under a given set of arguments should
  generally yield the same, reproducible results regardless of when or where
  they were run. This should be true even if users turn the default parallel
  behaviour of the function off or back on, or whether they change the
  `ptype` argument to "psock" or "fork" and back again. However, it cannot be
  guaranteed under every scenario. Perhaps the most obvious case is when
  `ritest()` is run without any declared strata or clusters. (Reason:
  Stacking in this simple case is turned off because it yields no efficiency
  gains.) In this case, the RNG stream will be sensitive to the _number_ of
  available cores on a user's computer. Two parallel cores will yield a
  slightly different result than four cores, or six cores, etc. Of course,
  users can always ensure perfect reproducibility by explicitly defining the
  number of required cores in the `ritest()` call via the `pcores` argument.
  Stepping back, the focus on reproducible exactitude rather misses the
  point in an exercise like randomization inference testing. Much more important is
  running enough permutation trials so that your rejection rates are stable
  and any minor differences due to different RNG seeds are moot. Remember,
  the ultimate goal of inference (and research) isn't simply to generate
  reproducible results under a very specific set of circumstances. Rather, it
  is to generate consistent insights that hold even under varying
  circumstances.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Simon Heß (2017). <cite>Robust Randomization inference with
  Stata: A guide and software</cite>, The Stata Journal, 17, Number 3, pp. 630–651</p>
<p>Alwyn Young (2019). <cite>Channeling Fisher: Randomization
  Tests and the Statistical Insignificance of Seemingly Significant
  Experimental Results</cite>, The Quarterly Journal of Economics, 134, Issue 2,
  pp. 557–598</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[print.ritest()], [plot.ritest()]</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Example 1: Basic functionality</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># First estimate a simple linaer regression on the base 'npk' dataset. For</span></span></span>
<span class="r-in"><span><span class="co"># this first example, we won't worry about strata or clusters, or other</span></span></span>
<span class="r-in"><span><span class="co"># experimental design complications.</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">K</span>, data <span class="op">=</span> <span class="va">npk</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Conduct RI on the 'N' (i.e. nitrogen) coefficient. We'll do 1,000</span></span></span>
<span class="r-in"><span><span class="co"># simulations and, just for illustration, limit the number of parallel cores</span></span></span>
<span class="r-in"><span><span class="co"># to 2 (default is half of the available cores). The 'verbose = TRUE'</span></span></span>
<span class="r-in"><span><span class="co"># argument simply prints the results upon completion, including the original</span></span></span>
<span class="r-in"><span><span class="co"># regression model summary.</span></span></span>
<span class="r-in"><span><span class="va">est_ri</span> <span class="op">=</span> <span class="fu">ritest</span><span class="op">(</span><span class="va">est</span>, <span class="st">'N'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running 1000 parallel RI simulations as forked processes across 2 CPU cores.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ******************</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * ORIGINAL MODEL *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ******************</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yield ~ N + P + K, data = npk)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -9.2667 -3.6542  0.7083  3.4792  9.3333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   54.650      2.205  24.784   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N1             5.617      2.205   2.547   0.0192 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P1            -1.183      2.205  -0.537   0.5974    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> K1            -3.983      2.205  -1.806   0.0859 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 5.401 on 20 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.3342,	Adjusted R-squared:  0.2343 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 3.346 on 3 and 20 DF,  p-value: 0.0397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ******************</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * RITEST RESULTS *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ******************</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">          Call: </span>lm(formula = yield ~ N + P + K, data = npk)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">   Res. var(s): </span>N1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">            H0: </span>N1=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">     Num. reps: </span>1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5.617        21      1000     0.021  0.007462  0.008726   0.03327  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Note: Confidence interval is with respect to p=c/n. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Note: c = #{|T| &gt;= |T(obs)|} </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Result: The RI rejection rate (0.021) is very similar to the parametric</span></span></span>
<span class="r-in"><span><span class="co"># p-value (0.019).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can plot the results and various options are available to customise the appearance.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est_ri</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ritest-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est_ri</span>, type <span class="op">=</span> <span class="st">'hist'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ritest-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># etc</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aside: By default, ritest() conducts a standard two-sided test against a</span></span></span>
<span class="r-in"><span><span class="co"># sharp null hypothesis of zero. You can can specify other null hypotheses as</span></span></span>
<span class="r-in"><span><span class="co"># part of the 'resampvar' string argument. For example, a (left) one-sided</span></span></span>
<span class="r-in"><span><span class="co"># test...</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">ritest</span><span class="op">(</span><span class="va">est</span>, <span class="st">'N&lt;=0'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ritest-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># ... or, null values different from zero.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">ritest</span><span class="op">(</span><span class="va">est</span>, <span class="st">'N=2'</span>, reps <span class="op">=</span> <span class="fl">1e3</span>, seed <span class="op">=</span> <span class="fl">1234L</span>, pcores <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ritest-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Example 2: Real-life example</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now that we've seen the basic functionality, here's a more realistic RI</span></span></span>
<span class="r-in"><span><span class="co"># example using data from a randomized control trial conducted in Colombia.</span></span></span>
<span class="r-in"><span><span class="co"># More details on the dataset -- kindly provided by the study authors -- can</span></span></span>
<span class="r-in"><span><span class="co"># be found in the accompanying helpfile ("?colombia"). The most important</span></span></span>
<span class="r-in"><span><span class="co"># thing to note is that we need to control for the stratified (aka "blocked")</span></span></span>
<span class="r-in"><span><span class="co"># and clustered experimental design.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"colombia"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We'll use the fixest package to estimate our parametric regression model,</span></span></span>
<span class="r-in"><span><span class="co"># specifying the strata (here: treatment-control pairs) as fixed-effects and</span></span></span>
<span class="r-in"><span><span class="co"># clustering the standard errors by location (here: city blocks).</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">co_est</span> <span class="op">=</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="va">dayscorab</span> <span class="op">~</span> <span class="va">b_treat</span> <span class="op">+</span> <span class="va">b_dayscorab</span> <span class="op">+</span> <span class="va">miss_b_dayscorab</span> <span class="op">|</span></span></span>
<span class="r-in"><span>                 <span class="va">b_pair</span> <span class="op">+</span> <span class="va">round2</span> <span class="op">+</span> <span class="va">round3</span>,</span></span>
<span class="r-in"><span>               vcov <span class="op">=</span> <span class="op">~</span><span class="va">b_block</span>, data <span class="op">=</span> <span class="va">colombia</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: 1,020 observations removed because of NA values (LHS: 1,020).</span>
<span class="r-in"><span><span class="va">co_est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OLS estimation, Dep. Var.: dayscorab</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations: 2,346</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed-effects: b_pair: 31,  round2: 2,  round3: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard-errors: Clustered (b_block) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate Std. Error  t value  Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b_treat          -0.180738   0.078174 -2.31201  0.024113 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b_dayscorab       0.524761   0.029423 17.83478 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> miss_b_dayscorab  0.603928   0.264174  2.28610  0.025678 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE: 1.91167     Adj. R2: 0.282038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Within R2: 0.266002</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run RI on the 'b_treat' variable, specifying the strata and clusters.</span></span></span>
<span class="r-in"><span><span class="co"># All three input styles work: bare names, strings, or formulas.</span></span></span>
<span class="r-in"><span><span class="va">co_ri</span> <span class="op">=</span> <span class="fu">ritest</span><span class="op">(</span><span class="va">co_est</span>, <span class="va">b_treat</span>, strata <span class="op">=</span> <span class="va">b_pair</span>, cluster <span class="op">=</span> <span class="va">b_block</span>,</span></span>
<span class="r-in"><span>               reps<span class="op">=</span><span class="fl">1e3</span>, seed<span class="op">=</span><span class="fl">123L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">co_ri</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">          Call: </span>feols(fml = dayscorab ~ b_treat + b_dayscorab + miss_b_dayscorab | b_pair + round2 + round3, data = colombia, vcov = ~b_block)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">   Res. var(s): </span>b_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">            H0: </span>b_treat=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;"> Strata var(s): </span>b_pair</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">        Strata: </span>31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Cluster var(s): </span>b_block</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">      Clusters: </span>63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">     Num. reps: </span>1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   T(obs)         c         n     p=c/n     SE(p)   CI 2.5%  CI 97.5%  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.1807       110      1000      0.11   0.01628   0.08322    0.1368  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ──────────────────────────────────────────────────────────────────────────────── </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Note: Confidence interval is with respect to p=c/n. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Note: c = #{|T| &gt;= |T(obs)|} </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">co_ri</span>, type <span class="op">=</span> <span class="st">'hist'</span>, highlight <span class="op">=</span> <span class="st">'fill'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ritest-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This time, the RI rejection rate (0.11) is noticeably higher than the</span></span></span>
<span class="r-in"><span><span class="co"># parametric p-value (0.024) from the regression model.</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

